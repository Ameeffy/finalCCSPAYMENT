<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="x-icon" href="img/logo.png"> <!-- Ensure img/logo.png exists -->
    <title>ORGANIZATION ANNOUNCEMENT</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">  
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            background-color: #F5FFFA;
        }

        
        .top {
            background-color: #F5FFFA;
            position: fixed;
            width: 100%;
            z-index: 1;
            display: flex;
            justify-content: end;
            align-items: center;
            padding-right: 20px;
            border-bottom: 1px solid rgb(0, 72, 0);
        }

        .sidebar {
            width: 12vw;
            background-color: #F5FFFA; 
            color: rgb(0, 0, 0);
            display: flex;
            flex-direction: column;            
            z-index: 2;
            border-right: 1px solid rgb(0, 72, 0);   
            padding: 10px;  
            position: fixed;
            height: 100vh;     
        }
        .main-content {
            width: 85vw;
            background-color: rgb(221, 231, 221);
            margin-left: 200px;
            position: relative; 
            border-radius: 10px;
            height: auto;  
        }
        .sidebar .logo {
            padding: 20px;
            text-align: center;
        }

        .sidebar .logo img {
            max-width: 110px;
            height: auto;
        }

        .sidebar .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: rgb(0, 0, 0);
            text-decoration: none;
            transition: all 0.3s ease;
            
            
        }

        .sidebar .nav-item .icon {
            margin-right: 15px;
        }

        .sidebar .nav-item .text {
            font-size: 16px;
        }

        .sidebar .nav-item.active {
            font-weight: bold;
            color: #f1f1f1; /* Light color for contrast */
        }

        .sidebar .nav-item.active .icon {
            color: #f1f1f1; /* Light color for contrast */
        }

        .sidebar .bottom-links {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid #fff;
        }

        .sidebar .bottom-links .nav-item {
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            
        }

        .sidebar .bottom-links .nav-item:hover {
            background-color: #085d15; /* Slightly darker green */
        }

       
        .spacer {
            flex: 1;
        }
        .full-container {
            display: flex;
            flex-direction: column;
            margin-top: 80px;
            border-radius: 10px;
        }

        h1 {
            font-size: 40px;
            margin-top: 40px;
            margin-left: 40px;
            font-weight: bold;
            font-family: Arial, Helvetica, sans-serif;
        }
        
        h3 {
            font-size: 20px;
            text-align: right;
            font-weight: bold;
           
        }

        .add-account-btn {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .set-semester-btn {
            position: absolute;
            top: 20px; 
            right: 20px; 
        }
        .content {
            margin-left: 260px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
       
        table {
    width: 97%;
    margin: 20px auto; 
    border-collapse: separate; 
    border-spacing: 0 10px; 
    max-width: 100%; 
}

th, td {
     
    padding: 8px;
    text-align: left;
    background-color: #ffffff;
}


th:first-child {
    border-top-left-radius: 8px; 
    border-bottom-left-radius: 8px; 
}

th:last-child {
    border-top-right-radius: 8px; 
    border-bottom-right-radius: 8px; 
}


td:first-child {
    border-top-left-radius: 8px; 
    border-bottom-left-radius: 8px; 
}

td:last-child {
    border-top-right-radius: 8px; 
    border-bottom-right-radius: 8px; 
}


th {
    background-color: #034b03;
    color: white;
    font-weight: bold;  
    font-size: 14px;
}


tr:hover td {
    background-color: #ddfadc;
    transform: translateX(5px) scale(1.05); 
    transition: transform 0.2s ease-in-out; 
    color: black;}

.icon-button {
    border: none;
    background-color: transparent;
    border-radius: 50%;
    padding: 10px;
    cursor: pointer;
    color: #034b03;
    transition: background-color 0.3s, transform 0.2s;
}

.icon-button:hover {
    background-color: rgba(3, 75, 3, 0.1); 
    transform: scale(1.1); 
}


.dropdown-item {
    width: 100%;
    border: none;
    background-color: transparent;
    cursor: pointer;
    color: #034b03;
    transition: background-color 0.3s;
}

.dropdown-item:hover {
    background-color: rgba(3, 75, 3, 0.1); 
}


.icon-button:hover + .dropdowns {
    display: block; 
}
.btn-submit {
    padding: 10px 20px;
    background-color: #034b03;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 20px;
}
.btn-submit:hover {
    background-color: #027b02;
}
  

    </style>
</head>
<body>


<div class="sidebar">
   
    <div class="logo">
        <img src="img/logo.png" alt="Logo">
    </div>
   
    <a href="organization-dashboard.html" class="nav-item" id="dashboard-link" style="background-color: #034b03; color: white;  border-radius: 15px;">
        <div class="icon">
            <i class="bi bi-speedometer2"></i> <!-- Updated icon for dashboard -->
        </div>
        <div class="text" style="font-weight: bold;">Dashboard</div>
    </a>
    <a href="organization-orders.html" class="nav-item" id="orders-link">
        <div class="icon">
            <i class="bi bi-cart"></i> <!-- Updated icon for orders -->
        </div>
        <div class="text">Orders</div>
    </a>
    <a href="organization-payment.html" class="nav-item" id="payment-link">
        <div class="icon">
            <i class="bi bi-credit-card"></i> <!-- Updated icon for payment -->
        </div>
        <div class="text">Payment</div>
    </a>
    <a href="organization-products.html" class="nav-item" id="products-link">
        <div class="icon">
            <i class="bi bi-box-seam"></i> <!-- Updated icon for products -->
        </div>
        <div class="text">Products</div>
    </a>
    <a href="organization-masterlist.html" class="nav-item" id="masterlist-link">
        <div class="icon">
            <i class="bi bi-list-task"></i> <!-- Updated icon for masterlist -->
        </div>
        <div class="text">Masterlist</div>
    </a>
    

   
</div>




<div class="top d-flex justify-content-end align-items-center p-2">
    <div id="organizationInfo" class="d-flex flex-grow-1">
        
    </div>
    <a style="color: #25330f; text-decoration: none; font-size: 18px; margin-right: 8px;">Welcome!</a>

    <i style="margin-right: 20px;">
        <li id="profile-item" class="dropdown-item">
            <a href="#">Loading...</a>
        </li>
    </i>
    <div class="dropdownsss" style="margin-right: 30px;">
        <a href="#" class="d-flex align-items-center text-decoration-none"  id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            
            <i class="fas fa-user-circle fa-2x" style="color: #25330f;"></i>
           
            <i class="fas fa-caret-down ms-2" style="color: #25330f;"></i>

            

        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            

            <li><a class="dropdown-item" href="#" id="logout">Sign Out</a></li>
        </ul>
    </div>
</div>
<script>
    function fetchLoggedInUserDetails() {
    const token = localStorage.getItem('token'); // Retrieve the token from localStorage

    if (!token) {
        window.location.href = 'adminlogin.html'; // Redirect to login if no token
        return;
    }

    fetch('http://localhost:5000/api/auth/organization-user/details', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(user => {
        if (!user) {
            throw new Error('User not found');
        }
        
        
        const fullName = `${user.firstname} ${user.lastname}`; 

        document.getElementById('profile-item').innerHTML = `
           <a style="color: #25330f; text-decoration: none; " href="organization-users-info.html">
   
   <h3 style="color: #25330f; text-decoration: none; font-size: 18px; margin-top:10px;">${user.firstname} ${user.lastname}</h3>
</a>


        `;
    })
    .catch(error => {
        console.error('Error fetching organization user details:', error);
        document.getElementById('profile-item').innerHTML = '<a href="#">Error loading profile</a>';
    });
}

// Call the function when the DOM is loaded
document.addEventListener('DOMContentLoaded', fetchLoggedInUserDetails);

</script>

<script>

    document.addEventListener('DOMContentLoaded', fetchOrganizationUserDetails);
    document.getElementById('logout').addEventListener('click', function(event) {
               event.preventDefault(); 
       
               
               localStorage.removeItem('token');
       
               
               window.location.href = 'adminlogin.html';
           });
   
   document.addEventListener('DOMContentLoaded', function() {
       const links = document.querySelectorAll('.sidebar .nav-item');

       links.forEach(link => {
           link.addEventListener('click', function() {
              
               links.forEach(item => item.classList.remove('active'));
               
               this.classList.add('active');
           });
       });
   });
</script>
<div class="full-container">

    
   
   

<div class="main-content">
 

    <div class="container" style="padding: 60px;">
        <div class="announcement-form">
            <h3 style="text-align: center;">Add Announcement</h3>
          <form id="announcementForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="announcementpicture">Announcement Picture</label>
                    <input type="file" class="form-control" id="announcementpicture" name="announcementpicture" required>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn-submit">Submit</button>
            </form>
        </div>
    </div>
        <div class="announcement-list">
            <h3 style="text-align: center;">Announcements</h3>
            <table class="announcement-table">
                <thead>
                    <tr>
                        <th>Picture</th>
                        <th>Description</th>
                        <th>Created By</th>
                    </tr>
                </thead>
                <tbody id="announcementList">
                    <!-- Announcements will be loaded here -->
                </tbody>
            </table>
        </div>
    
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    // Function to submit the form for adding announcements
    $('#announcementForm').on('submit', function(event) {
        event.preventDefault();

        // Show SweetAlert confirmation before submitting the form
        Swal.fire({
            title: 'Are you sure?',
            text: 'Do you want to add this announcement?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, add it!',
            cancelButtonText: 'Cancel',
        }).then((result) => {
            if (result.isConfirmed) {
                const formData = new FormData(this);
                const token = localStorage.getItem('token');
        
                $.ajax({
                    url: 'http://localhost:5000/api/auth/addannouncement',
                    type: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
    // Show success message with SweetAlert
    Swal.fire(
        'Success!',
        'Announcement added successfully.',
        'success'
    ).then(() => {
        // After SweetAlert closes, reload the page
        location.reload();  // Reload the page after SweetAlert is closed
    });
}
,
                    error: function(xhr, status, error) {
                        Swal.fire(
                            'Error!',
                            'There was an error adding the announcement.',
                            'error'
                        );
                    }
                });
            }
        });
    });

    // Function to load and display announcements
    function loadAnnouncements() {
        const token = localStorage.getItem('token');

        $.ajax({
            url: 'http://localhost:5000/api/auth/getannouncements',
            type: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            success: function(response) {
                const announcements = response;
                const announcementList = $('#announcementList');
                announcementList.empty();

                announcements.forEach(announcement => {
                    const row = `
                        <tr>
                            <td>
                                <img src="/uploads/announcements/${announcement.organization_id}/${announcement.announcementpicture}" alt="Announcement" width="100">
                            </td>
                            <td>${announcement.description}</td>
                            <td>${announcement.created_by}</td>
                        </tr>
                    `;
                    announcementList.append(row);
                });
            },
            error: function(xhr, status, error) {
                Swal.fire(
                    'Error!',
                    'There was an error loading the announcements.',
                    'error'
                );
            }
        });
    }

    // Load announcements on page load
    $(document).ready(function() {
        loadAnnouncements();
    });
</script>

    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // JavaScript to handle the active class on sidebar items
    document.addEventListener('DOMContentLoaded', function() {
        const links = document.querySelectorAll('.sidebar .nav-item');

        links.forEach(link => {
            link.addEventListener('click', function() {
                
                links.forEach(item => item.classList.remove('active'));
               
                this.classList.add('active');
            });
        });
    });
</script>

<body>

    <script>
        document.getElementById('logout').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default link behavior
    
            
            localStorage.removeItem('token');
    
            
            window.location.href = 'adminlogin.html';
        });
    </script>
    

   
   
    <script>
        function fetchOrganizationData() {
    const token = localStorage.getItem('token'); // Retrieve token from storage
    if (!token) {
        window.location.href = 'adminlogin.html'; // Redirect to login if no token
        return;
    }

    fetch('http://localhost:5000/api/auth/organization/details', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data && data.name) {
            
            const infoDiv = document.getElementById('organizationInfo');
            infoDiv.innerHTML = `
              <h2 
    style="color: #25330f; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-left: 190px; font-size: 30px; text-transform: uppercase;">
    ${data.name}
</h2>
       
              
            `;
        } else {
            document.getElementById('organizationInfo').innerText = 'No organization data found.';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('errorMessages').innerText = 'An error occurred. Please try again.';
    });
}


document.addEventListener('DOMContentLoaded', fetchOrganizationData);

    </script>
</body>
</html>
